<% if current_user.allergy != nil %>  
<h2>세부정보를 입력해주세요 </h2>
<%# <%= resource_name.to_s.humanize %> 
<%= form_for(resource, as: resource_name, url: registration_path(resource_name), html: { method: :put }) do |f| %>
  <%= devise_error_messages! %>
  <h5>필수</h5>
  <div class="field">
    <%= f.label :email %><br />
    <%= f.email_field :email, autofocus: true, autocomplete: "email" , class: "form-control" %>
  </div>

  <%# <div class = "field">
    <%= f.label "아이디" %>
    <%# <%= f.text_field :IDe, class: "form-control" , placeholder: "소셜로그인의 경우 필요없음" %>
     <%# <p class = "mt-4 mb-2" id = "check-id"></p>
  </div> %> 

  <div class = "field">
    <%= f.label "이름" %><br/>
    <%= f.text_field :name, class: "form-control", id: "checkname", :required => true %>
    <p class = "mt-4 mb-2" id = "check-warning"></p>
  </div>
  <hr>

 <hr><h5>선택</h5>
  <div class="field">
    <h5> 성별 </h5> 
      <%= f.radio_button :gender, "male" %> 남자<br/>
      <%= f.radio_button :gender, "female" %> 여자 <br/>
  </div><br/>

  <div class="field">
    <h5> 나이 </h5> 
    <%= f.select :ages, options_for_select([["10대이하", "10대이하"], ["20-29","20-29"], ["20-30대","20-30대"], ["40-50대","40-50대"],["60대이상","60대이상"]]), { prompt: '나이를 선택해주세요' } %>  
  </div><br/><br/>
 
  <div class="field">
    <h4> 알레르기정보 </h4>
    <div> 유제품 및 난류:
      <%= check_box_tag 'user[allergy][]', '난류', current_user.allergy.include?('난류') %>난류
      <%= check_box_tag 'user[allergy][]', '우유', current_user.allergy.include?('우유') %> 우유 
    </div><br/>
    <div> 과채류 및 곡류:
     <%= check_box_tag 'user[allergy][]', '복숭아/토마토', current_user.allergy.include?('복숭아/토마토') %> 복숭아/토마토
     <%= check_box_tag 'user[allergy][]', '대두(콩)', current_user.allergy.include?('대두(콩)') %> 대두(콩) 
     <%= check_box_tag 'user[allergy][]', '밀/메밀', current_user.allergy.include?('밀/메밀') %> 밀/메밀 
    </div><br/>
    <div> 육류:
      <%= check_box_tag 'user[allergy][]', '닭고기', current_user.allergy.include?('닭고기') %> 닭고기 
      <%= check_box_tag 'user[allergy][]', '돼지고기', current_user.allergy.include?('돼지고기') %>돼지고기 
      <%= check_box_tag 'user[allergy][]', '쇠고기', current_user.allergy.include?('쇠고기') %>쇠고기
    </div><br/> 
    <div> 어패류:
      <%= check_box_tag 'user[allergy][]', '고등어/오징어/게', current_user.allergy.include?('고등어/오징어') %>고등어/오징어
      <%= check_box_tag 'user[allergy][]', '게/새우', current_user.allergy.include?('게/새우') %> 게/새우 
      <%= check_box_tag 'user[allergy][]', '조개류/홍합/전복/굴', current_user.allergy.include?('조개류/홍합/전복/굴') %>조개류/홍합/전복/굴
    </div><br/>
    <div> 견과류,아황산:
      <%= check_box_tag 'user[allergy][]', '땅콩/호두', current_user.allergy.include?('땅콩/호두') %> 땅콩/호두 
      <%= check_box_tag 'user[allergy][]', '아황산류', current_user.allergy.include?('아황산류') %> 아황산류 
    </div><br/>
    <div>
      기타:<%= f.text_field :allergy_etc %>
      <input id="user[allergy][]" name="user[allergy][]"  class="edit" type="hidden"/>          
    </div>
  </div><br/>

  <div class="field">
    <%= f.label :profileimg, "프로필 사진" %><br />
    <%= f.file_field :profileimg, accept: 'image/png, image/gif, image/jpeg' %>
  </div>
  
  <div class="actions">
    <%= f.submit "Update", id: "submitButton" %>
  </div>
<% end %>
<%# <h3>Cancel my account</h3> %>
<%# <p>Unhappy? <%= button_to "Cancel my account", registration_path(resource_name), data: { confirm: "Are you sure?" }, method: :delete %>
<%= link_to "Back", :back %>

<% else %>
  <%= render partial: 'layouts/foredit'%>
<% end %>

<script>
 document.getElementById("submitButton").disabled = true;

// document.getElementById("checkButton").addEventListener("click", function(){
 $(document).ready(function(){  
     $("#checkname").keyup(function(){                           
      var nameIn = document.getElementById("checkname").value;
        $.ajax({    //checkid와같이x
          async : true,
          type : "POST",
          data : {name : nameIn},
          url : "checkDouble",
          dataType : "json",
          success : function(data){
            
            console.log(data);
          
            if (data["ableName"] == 1){
                document.getElementById("check-warning").innerHTML = "해당 닉네임은 이미 사용중입니다";
                 document.getElementById("submitButton").disabled = true;
            }
            else if(data["ableName"] == 0){
                document.getElementById("check-warning").innerHTML = "사용가능한 닉네임입니다";
                 document.getElementById("submitButton").disabled = false;
            }
          }
        })
    })
 })

</script>
